<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–µ—á–∞—Ç—å –§–æ—Ç–æ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            padding-bottom: 80px;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color);
        }

        .header p {
            color: var(--tg-theme-hint-color, #999);
            font-size: 14px;
        }

        .upload-zone {
            border: 2px dashed var(--tg-theme-button-color, #0088cc);
            border-radius: 12px;
            padding: 32px 16px;
            text-align: center;
            margin-bottom: 24px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-zone:hover {
            background: var(--tg-theme-secondary-bg-color, #f4f4f5);
        }

        .upload-zone.dragover {
            background: var(--tg-theme-secondary-bg-color, #f4f4f5);
            border-color: var(--tg-theme-button-color, #0088cc);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .upload-text {
            font-size: 16px;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color);
        }

        .upload-hint {
            font-size: 13px;
            color: var(--tg-theme-hint-color, #999);
        }

        #fileInput {
            display: none;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .photo-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            background: var(--tg-theme-secondary-bg-color, #f4f4f5);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-number {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255, 59, 48, 0.9);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .delete-btn:active {
            transform: scale(0.9);
        }

        .counter {
            text-align: center;
            padding: 12px;
            background: var(--tg-theme-secondary-bg-color, #f4f4f5);
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .counter.complete {
            background: rgba(52, 199, 89, 0.1);
            color: #34c759;
        }

        .order-form {
            background: var(--tg-theme-secondary-bg-color, #f4f4f5);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
            display: none;
        }

        .order-form.visible {
            display: block;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--tg-theme-text-color);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 8px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .price-info {
            background: var(--tg-theme-bg-color, #fff);
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .price-row.total {
            font-size: 18px;
            font-weight: 600;
            padding-top: 8px;
            border-top: 1px solid var(--tg-theme-hint-color, #e0e0e0);
            margin-top: 8px;
        }

        .error {
            background: rgba(255, 59, 48, 0.1);
            color: #ff3b30;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            display: none;
        }

        .error.visible {
            display: block;
        }

        .success {
            background: rgba(52, 199, 89, 0.1);
            color: #34c759;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            display: none;
        }

        .success.visible {
            display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì∏ –ü–µ—á–∞—Ç—å –§–æ—Ç–æ</h1>
        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ 10 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</p>
    </div>

    <div class="error" id="error"></div>
    <div class="success" id="success"></div>

    <div class="upload-zone" id="uploadZone">
        <div class="upload-icon">üì§</div>
        <div class="upload-text">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>
        <div class="upload-hint">–∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å—é–¥–∞</div>
    </div>

    <input type="file" id="fileInput" accept="image/*" multiple>

    <div class="counter" id="counter">
        –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–æ—Ç–æ: <strong>0/10</strong>
    </div>

    <div class="photos-grid" id="photosGrid"></div>

    <div class="order-form" id="orderForm">
        <h3 style="margin-bottom: 16px;">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h3>
        
        <div class="form-group">
            <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
            <textarea id="address" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏"></textarea>
        </div>

        <div class="form-group">
            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" id="phone" placeholder="+7 (___) ___-__-__">
        </div>

        <div class="form-group">
            <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
            <textarea id="comment" placeholder="–û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∫ –∑–∞–∫–∞–∑—É"></textarea>
        </div>

        <div class="price-info">
            <div class="price-row">
                <span>–ü–µ—á–∞—Ç—å (<span id="photoCount">0</span> —Ñ–æ—Ç–æ)</span>
                <span id="printPrice">‚ÇΩ0</span>
            </div>
            <div class="price-row">
                <span>–î–æ—Å—Ç–∞–≤–∫–∞</span>
                <span>‚ÇΩ200</span>
            </div>
            <div class="price-row total">
                <span>–ò—Ç–æ–≥–æ</span>
                <span id="totalPrice">‚ÇΩ200</span>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.setText('–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑');
        tg.MainButton.hide();

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã
        document.body.style.background = tg.themeParams.bg_color || '#ffffff';

        // –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
        let photos = [];
        const MAX_PHOTOS = 10;

        // –¶–µ–Ω—ã
        const PRICE_PER_PHOTO = 20; // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ —Ñ–æ—Ç–æ
        const DELIVERY_PRICE = 200;

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const photosGrid = document.getElementById('photosGrid');
        const counter = document.getElementById('counter');
        const orderForm = document.getElementById('orderForm');
        const errorEl = document.getElementById('error');
        const successEl = document.getElementById('success');
        const printSize = document.getElementById('printSize');

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
        uploadZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFiles);

        // Drag & Drop
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handleFiles({ target: { files: e.dataTransfer.files } });
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
        function handleFiles(e) {
            const files = Array.from(e.target.files);
            
            if (photos.length + files.length > MAX_PHOTOS) {
                showError(`–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞–∫—Å–∏–º—É–º ${MAX_PHOTOS} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π`);
                return;
            }

            files.forEach(file => {
                if (!file.type.startsWith('image/')) {
                    showError('–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    photos.push({
                        id: Date.now() + Math.random(),
                        data: e.target.result,
                        file: file
                    });
                    updateUI();
                };
                reader.readAsDataURL(file);
            });

            fileInput.value = '';
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ
        function deletePhoto(id) {
            photos = photos.filter(p => p.id !== id);
            updateUI();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞
            counter.innerHTML = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–æ—Ç–æ: <strong>${photos.length}/${MAX_PHOTOS}</strong>`;
            
            if (photos.length === MAX_PHOTOS) {
                counter.classList.add('complete');
            } else {
                counter.classList.remove('complete');
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ —Ñ–æ—Ç–æ
            photosGrid.innerHTML = '';
            photos.forEach((photo, index) => {
                const item = document.createElement('div');
                item.className = 'photo-item';
                item.innerHTML = `
                    <img src="${photo.data}" alt="–§–æ—Ç–æ ${index + 1}">
                    <div class="photo-number">${index + 1}</div>
                    <button class="delete-btn" onclick="deletePhoto(${photo.id})">√ó</button>
                `;
                photosGrid.appendChild(item);
            });

            // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –∑–∞–∫–∞–∑–∞
            if (photos.length > 0) {
                orderForm.classList.add('visible');
                tg.MainButton.show();
                updatePrice();
            } else {
                orderForm.classList.remove('visible');
                tg.MainButton.hide();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã
        function updatePrice() {
            const printTotal = photos.length * PRICE_PER_PHOTO;
            const total = printTotal + DELIVERY_PRICE;

            document.getElementById('photoCount').textContent = photos.length;
            document.getElementById('printPrice').textContent = `‚ÇΩ${printTotal}`;
            document.getElementById('totalPrice').textContent = `‚ÇΩ${total}`;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            errorEl.textContent = message;
            errorEl.classList.add('visible');
            setTimeout(() => errorEl.classList.remove('visible'), 3000);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö
        function showSuccess(message) {
            successEl.textContent = message;
            successEl.classList.add('visible');
            setTimeout(() => successEl.classList.remove('visible'), 3000);
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞
        tg.MainButton.onClick(() => {
            const address = document.getElementById('address').value.trim();
            const phone = document.getElementById('phone').value.trim();

            if (!address) {
                showError('–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏');
                return;
            }

            if (!phone) {
                showError('–£–∫–∞–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω');
                return;
            }

            const orderData = {
                photos: photos.map(p => p.data),
                photoCount: photos.length,
                printSize: '10x15',  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                paperType: 'glossy', // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±—É–º–∞–≥–∞
                address: address,
                phone: phone,
                comment: document.getElementById('comment').value,
                totalPrice: document.getElementById('totalPrice').textContent,
                userId: tg.initDataUnsafe?.user?.id,
                userName: tg.initDataUnsafe?.user?.first_name
            };

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç
            tg.sendData(JSON.stringify(orderData));
            
            // –ò–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å tg.close() –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
            showSuccess('–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.');
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateUI();
    </script>
</body>
</html>
